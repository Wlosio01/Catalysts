# Example data
#Y <- c(18.0,15.0,18.0,16.0,17.0,15.0,14.0,14.0,14.0,15.0,15.0,14.0,15.0,14.0,24.0,22.0,18.0,21.0,27.0,26.0,25.0,24.0,25.0,26.0,21.0,10.0,10.0,11.0,9.0,27.0,28.0,25.0,19.0,16.0,17.0,19.0,18.0,14.0,14.0,14.0,14.0,12.0,13.0,13.0,18.0,22.0,19.0,18.0,23.0,28.0,30.0,30.0,31.0,35.0,27.0,26.0,24.0,25.0,23.0,20.0,21.0,13.0,14.0,15.0,14.0,17.0,11.0,13.0,12.0,13.0,19.0,15.0,13.0,13.0,14.0,18.0,22.0,21.0,26.0,22.0,28.0,23.0,28.0,27.0,13.0,14.0,13.0,14.0,15.0,12.0,13.0,13.0,14.0,13.0,12.0,13.0,18.0,16.0,18.0,18.0,23.0,26.0,11.0,12.0,13.0,12.0,18.0,20.0,21.0,22.0,18.0,19.0,21.0,26.0,15.0,16.0,29.0,24.0,20.0,19.0,15.0,24.0,20.0,11.0,20.0,19.0,15.0,31.0,26.0,32.0,25.0,16.0,16.0,18.0,16.0,13.0,14.0,14.0,14.0,29.0,26.0,26.0,31.0,32.0,28.0,24.0,26.0,24.0,26.0,31.0,19.0,18.0,15.0,15.0,16.0,15.0,16.0,14.0,17.0,16.0,15.0,18.0,21.0,20.0,13.0,29.0,23.0,20.0,23.0,24.0,25.0,24.0,18.0,29.0,19.0,23.0,23.0,22.0,25.0,33.0,28.0,25.0,25.0,26.0,27.0,17.5,16.0,15.5,14.5,22.0,22.0,24.0,22.5,29.0,24.5,29.0,33.0,20.0,18.0,18.5,17.5,29.5,32.0,28.0,26.5,20.0,13.0,19.0,19.0,16.5,16.5,13.0,13.0,13.0,31.5,30.0,36.0,25.5,33.5,17.5,17.0,15.5,15.0,17.5,20.5,19.0,18.5,16.0,15.5,15.5,16.0,29.0,24.5,26.0,25.5,30.5,33.5,30.0,30.5,22.0,21.5,21.5,43.1,36.1,32.8,39.4,36.1,19.9,19.4,20.2,19.2,20.5,20.2,25.1,20.5,19.4,20.6,20.8,18.6,18.1,19.2,17.7,18.1,17.5,30.0,27.5,27.2,30.9,21.1,23.2,23.8,23.9,20.3,17.0,21.6,16.2,31.5,29.5,21.5,19.8,22.3,20.2,20.6,17.0,17.6,16.5,18.2,16.9,15.5,19.2,18.5,31.9,34.1,35.7,27.4,25.4,23.0,27.2,23.9,34.2,34.5,31.8,37.3,28.4,28.8,26.8,33.5,41.5,38.1,32.1,37.2,28.0,26.4,24.3,19.1,34.3,29.8,31.3,37.0,32.2,46.6,27.9,40.8,44.3,43.4,36.4,30.0,44.6,33.8,29.8,32.7,23.7,35.0,32.4,27.2,26.6,25.8,23.5,30.0,39.1,39.0,35.1,32.3,37.0,37.7,34.1,34.7,34.4,29.9,33.0,33.7,32.4,32.9,31.6,28.1,30.7,25.4,24.2,22.4,26.6,20.2,17.6,28.0,27.0,34.0,31.0,29.0,27.0,24.0,36.0,37.0,31.0,38.0,36.0,36.0,36.0,34.0,38.0,32.0,38.0,25.0,38.0,26.0,22.0,32.0,36.0,27.0,27.0,44.0,32.0,28.0,31)

#X3 <- c(8,8,8,8,8,8,8,8,8,8,8,8,8,8,4,6,6,6,4,4,4,4,4,4,6,8,8,8,8,4,4,4,6,6,6,6,6,8,8,8,8,8,8,8,6,4,6,6,4,4,4,4,4,4,4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,8,3,8,8,8,8,4,4,4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,8,8,8,8,6,6,6,6,6,4,8,8,8,8,6,4,4,4,3,4,6,4,8,8,4,4,4,4,8,4,6,8,6,6,6,4,4,4,4,6,6,6,8,8,8,8,8,4,4,4,4,4,4,4,4,4,4,4,6,6,6,6,8,8,8,8,6,6,6,6,6,8,8,4,4,6,4,4,4,4,6,4,6,4,4,4,4,4,4,4,4,4,4,8,8,8,8,6,6,6,6,4,4,4,4,6,6,6,6,4,4,4,4,4,8,4,6,6,8,8,8,8,4,4,4,4,4,8,8,8,8,6,6,6,6,8,8,8,8,4,4,4,4,4,4,4,4,6,4,3,4,4,4,4,4,8,8,8,6,6,6,4,6,6,6,6,6,6,8,6,8,8,4,4,4,4,4,4,4,4,5,6,4,6,4,4,6,6,4,6,6,8,8,8,8,8,8,8,8,4,4,4,4,5,8,4,8,4,4,4,4,4,6,6,4,4,4,4,4,4,4,4,6,4,4,4,4,4,4,4,4,4,4,5,4,4,4,4,6,3,4,4,4,4,4,6,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,6,6,6,6,8,6,6,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,6,6,4,6,4,4,4,4,4,4,4,4)

#X2 <- c(307.0,350.0,318.0,304.0,302.0,429.0,454.0,440.0,455.0,390.0,383.0,340.0,400.0,455.0,113.0,198.0,199.0,200.0, 97.0, 97.0,110.0,107.0,104.0,121.0,199.0,360.0,307.0,318.0,304.0, 97.0,140.0,113.0,232.0,225.0,250.0,250.0,232.0,350.0,400.0,351.0,318.0,383.0,400.0,400.0,258.0,140.0,250.0,250.0,122.0,116.0, 79.0, 88.0, 71.0, 72.0, 97.0, 91.0,113.0, 97.5, 97.0,140.0,122.0,350.0,400.0,318.0,351.0,304.0,429.0,350.0,350.0,400.0, 70.0,304.0,307.0,302.0,318.0,121.0,121.0,120.0, 96.0,122.0, 97.0,120.0, 98.0, 97.0,350.0,304.0,350.0,302.0,318.0,429.0,400.0,351.0,318.0,440.0,455.0,360.0,225.0,250.0,232.0, 250.0, 198.0,  97.0, 400.0, 400.0, 360.0, 350.0, 232.0,  97.0, 140.0, 108.0,  70.0, 122.0, 155.0,  98.0, 350.0, 400.0,  68.0, 116.0, 114.0, 121.0, 318.0, 121.0, 156.0, 350.0, 198.0, 232.0, 250.0,  79.0, 122.0,  71.0, 140.0, 250.0, 258.0, 225.0, 302.0, 350.0, 318.0, 302.0, 304.0,  98.0,  79.0,  97.0,  76.0,  83.0,  90.0,  90.0, 116.0, 120.0, 108.0,  79.0, 225.0, 250.0, 250.0, 250.0, 400.0, 350.0, 318.0, 351.0, 231.0, 250.0, 258.0, 225.0, 231.0, 262.0, 302.0,  97.0, 140.0, 232.0, 140.0, 134.0,  90.0, 119.0, 171.0,  90.0, 232.0, 115.0, 120.0, 121.0, 121.0,  91.0, 107.0, 116.0, 140.0,  98.0, 101.0, 305.0, 318.0, 304.0, 351.0, 225.0, 250.0, 200.0, 232.0,  85.0,  98.0,  90.0,  91.0, 225.0, 250.0, 250.0, 258.0,  97.0,  85.0,  97.0, 140.0, 130.0, 318.0, 120.0, 156.0, 168.0, 350.0, 350.0, 302.0, 318.0,  98.0, 111.0,  79.0, 122.0,  85.0, 305.0, 260.0, 318.0, 302.0, 250.0, 231.0, 225.0, 250.0, 400.0, 350.0, 400.0, 351.0,  97.0, 151.0,  97.0, 140.0,  98.0,  98.0,  97.0,  97.0, 146.0, 121.0,  80.0,  90.0,  98.0,  78.0,  85.0,  91.0, 260.0, 318.0, 302.0, 231.0, 200.0, 200.0, 140.0, 225.0, 232.0, 231.0, 200.0, 225.0, 258.0, 305.0, 231.0, 302.0, 318.0,  98.0, 134.0, 119.0, 105.0, 134.0, 156.0, 151.0, 119.0, 131.0, 163.0, 121.0, 163.0,  89.0,  98.0, 231.0, 200.0, 140.0, 232.0, 225.0, 305.0, 302.0, 351.0, 318.0, 350.0, 351.0, 267.0, 360.0,  89.0,  86.0,  98.0, 121.0, 183.0, 350.0, 141.0, 260.0, 105.0, 105.0,  85.0,  91.0, 151.0, 173.0, 173.0, 151.0,  98.0,  89.0,  98.0,  86.0, 151.0, 140.0, 151.0, 225.0,  97.0, 134.0, 120.0, 119.0, 108.0,  86.0, 156.0,  85.0,  90.0,  90.0, 121.0, 146.0,  91.0,  97.0,  89.0, 168.0,  70.0, 122.0, 107.0, 135.0, 151.0, 156.0, 173.0, 135.0,  79.0,  86.0,  81.0,  97.0,  85.0,  89.0,  91.0, 105.0,  98.0,  98.0, 105.0, 107.0, 108.0, 119.0, 120.0, 141.0, 145.0, 168.0, 146.0, 231.0, 350.0, 200.0, 225.0, 112.0, 112.0, 112.0, 112.0, 135.0, 151.0, 140.0, 105.0,  91.0,  91.0, 105.0,  98.0, 120.0, 107.0, 108.0,  91.0,  91.0,  91.0, 181.0, 262.0, 156.0, 232.0, 144.0, 135.0, 151.0, 140.0,  97.0, 135.0, 120.0,119)

#X1 <- c(3504,3693,3436,3433,3449,4341,4354,4312,4425,3850,3563,3609,3761,3086,2372,2833,2774,2587,2130,1835,2672,2430,2375,2234,2648,4615,4376,4382,4732,2130,2264,2228,2634,3439,3329,3302,3288,4209,4464,4154,4096,4955,4746,5140,2962,2408,3282,3139,2220,2123,2074,2065,1773,1613,1834,1955,2278,2126,2254,2408,2226,4274,4385,4135,4129,3672,4633,4502,4456,4422,2330,3892,4098,4294,4077,2933,2511,2979,2189,2395,2288,2506,2164,2100,4100,3672,3988,4042,3777,4952,4464,4363,4237,4735,4951,3821,3121,3278,2945,3021,2904,1950,4997,4906,4654,4499,2789,2279,2401,2379,2124,2310,2472,2265,4082,4278,1867,2158,2582,2868,3399,2660,2807,3664,3102,2901,3336,1950,2451,1836,2542,3781,3632,3613,4141,4699,4457,4638,4257,2219,1963,2300,1649,2003,2125,2108,2246,2489,2391,2000,3264,3459,3432,3158,4668,4440,4498,4657,3907,3897,3730,3785,3039,3221,3169,2171,2639,2914,2592,2702,2223,2545,2984,1937,3211,2694,2957,2945,2671,1795,2464,2220,2572,2255,2202,4215,4190,3962,4215,3233,3353,3012,3085,2035,2164,1937,1795,3651,3574,3645,3193,1825,1990,2155,2565,3150,3940,3270,2930,3820,4380,4055,3870,3755,2045,2155,1825,2300,1945,3880,4060,4140,4295,3520,3425,3630,3525,4220,4165,4325,4335,1940,2740,2265,2755,2051,2075,1985,2190,2815,2600,2720,1985,1800,1985,2070,1800,3365,3735,3570,3535,3155,2965,2720,3430,3210,3380,3070,3620,3410,3425,3445,3205,4080,2155,2560,2300,2230,2515,2745,2855,2405,2830,3140,2795,3410,1990,2135,3245,2990,2890,3265,3360,3840,3725,3955,3830,4360,4054,3605,3940,1925,1975,1915,2670,3530,3900,3190,3420,2200,2150,2020,2130,2670,2595,2700,2556,2144,1968,2120,2019,2678,2870,3003,3381,2188,2711,2542,2434,2265,2110,2800,2110,2085,2335,2950,3250,1850,2145,1845,2910,2420,2500,2290,2490,2635,2620,2725,2385,1755,1875,1760,2065,1975,2050,1985,2215,2045,2380,2190,2210,2350,2615,2635,3230,3160,2900,2930,3415,3725,3060,3465,2605,2640,2395,2575,2525,2735,2865,1980,2025,1970,2125,2125,2160,2205,2245,1965,1965,1995,2945,3015,2585,2835,2665,2370,2950,2790,2130,2295,2625,2720)

# Algorithm
HellwigForTwoX <- function(Y, listX)
{
  # We will use binary notation to optimize the algorithm
  H <- 0 
  for (j in 1:2){
    # We count rj
    corXY <- cor(listX[[j]],Y)
    sum <- 0 
    for(k in 1:2){
      #we count sum of rij
      sum = sum + abs(cor(listX[[j]], listX[[k]]))
    }
    # Here we count H by add all h in loop
    H = H + (corXY^2)/sum
  }
  return(H)
}

X1 <- mtcars[[1]]
X2 <- mtcars[[2]]
X3 <- mtcars[[3]]
X4 <- mtcars[[4]]
X5 <- mtcars[[5]]
X6 <- mtcars[[7]]
Y <- mtcars[[6]]
# We put X to list in order
xlist <- list(X1,X2,X3,X4, X5, X6)

Catalysis <- function(Y,xlist){
  n <- length(xlist)
  # We create empty vector for X corelations with Y
  R0 <- c()
  # Vector for information about direction of corelation
  Rsign <- c()
  for(i in 1:n){
    if(cor(Y,xlist[[i]]) >= 0){
      Rsign <- c(Rsign,1)
    }
    else{
      Rsign <- c(Rsign,0)
    }
    R0 <- c(R0,abs(cor(Y,xlist[[i]])))
  }
  R1 <- order(R0)
  # We order also corelations of X 
  Rsign <- Rsign[R1]
  # If direction is positive we have 1, if negative -1
  Rsign[Rsign != 0] = 1
  Rsign[Rsign == 0] = -1
  # We sort xlist in order of R0
  xlist <- xlist[R1]
  R0 <- sort(R0)
  R <- matrix(nrow = n, ncol = n)
  # List with i, j index of catalysts
  catalystsIndex <- list()
  for(i in 1:n){
    for(j in 1:n){
      # We multiply cor by our vector with direction of corelations X
      if(i == j){
      R[i,j] <- 1}
      else{
        R[i,j] <- cor(xlist[[i]]*Rsign[[i]],xlist[[j]]*Rsign[[j]])
      }
      # We find catalysts
      if(j > i && (R[i,j] > (R0[i]/R0[j]) || R[i,j] < 0)){
        n1 <- length(catalystsIndex)
        catalystsIndex[[n1 +1]] <- c(i,j)
      }
    }
  }
  if(length(catalystsIndex) != 0){
  for(i in 1:length(catalystsIndex)){
    R0prim <- c(R0[catalystsIndex[[i]][1]],R0[catalystsIndex[[i]][2]])
    Rprim <- c(1,R[catalystsIndex[[i]][1],catalystsIndex[[i]][2]],R[catalystsIndex[[i]][1],catalystsIndex[[i]][2]],1)
    R0prim <- matrix(R0prim, nrow = 2)
    Rprim <- matrix(Rprim, ncol = 2, nrow = 2)
    R2 = (t(R0prim)%*%solve(Rprim))%*%R0prim;
    catalystsIndex[[i]][3] <- R2
    catalystsIndex[[i]][4] <- HellwigForTwoX(Y, list(xlist[[catalystsIndex[[i]][1]]],xlist[[catalystsIndex[[i]][2]]]))
    catalystsIndex[[i]][5] <- catalystsIndex[[i]][3] -catalystsIndex[[i]][4]
    # We change index of X to basic in first list
    catalystsIndex[[i]][1] <- R1[catalystsIndex[[i]][1]]
    catalystsIndex[[i]][2] <- R1[catalystsIndex[[i]][2]]
  }
  return(catalystsIndex)}
  else{
    print("Brak katalizatorów")
    return(NULL)
  }
}
# We put our pairs catalysts into list
catalysts <- Catalysis(Y,xlist)
#catalysts[[i]][1] and catalysts[[i]][2] shows indexes of X
#catalysts[[i]][3] shows R2
#catalysts[[i]][4] shows H
#catalysts[[i]][5] shows R2 - H

